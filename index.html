<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Island Mystery Game</title>
		<script type="text/javascript" src="MV.js"></script>
		<script type="text/javascript" src="webgl-utils.js"></script>
		<script type="text/javascript" src="initShaders.js"></script>
		<script type="text/javascript" src="camera.js"></script>
		<script type="text/javascript" src="map.js"></script>
		<script type="text/javascript" src="player.js"></script>
		<script type="text/javascript" src="texture.js"></script>
		<script type="text/javascript" src="shapes/shape.js"></script>
		<script type="text/javascript" src="shapes/cube.js"></script>
		<script type="text/javascript" src="shapes/multiTexCube.js"></script>
		<script type="text/javascript" src="shapes/sphere.js"></script>
		<script type="text/javascript" src="sky.js"></script>
		<script type="text/javascript" src="shapes/hexagonalPrism.js"></script>
		<script type="text/javascript" src="shapes/hexagonalPyramid.js"></script>
		<script type="text/javascript" src="objects/tree.js"></script>
		<script type="text/javascript" src="objects/paperTree.js"></script>

		<script type="text/javascript" src="scene.js"></script>

		<script id="shader-vertex" type="x-shader/x-vertex">
			precision mediump float;

			// Position attributes and uniforms
			attribute vec3 vPosition;
			attribute vec3 vNormal;
			attribute vec2 texCoord;
			uniform mat4 modelMatrix;
			uniform mat4 projViewMatrix;
			uniform mat4 normalMat;

			uniform vec3 lightPosition;

			varying vec2 fUV;
			varying vec3 N, L, E;
			void main() {
				// Make sure our w components are set properly
				vec4 pos  = vec4(vPosition, 1.0);
				vec4 norm = vec4(vNormal, 0.0);

				vec3 posInWorld    = (modelMatrix * pos).xyz;
				vec3 normalInWorld = (normalMat * norm).xyz;
				vec3 lightInWorld  = lightPosition; // Light already in world coordinates

				// We ignore specular highlights
				N = normalize(normalInWorld);
				L = normalize(lightInWorld - posInWorld);
				E = normalize(-posInWorld);

				fUV = texCoord;
				gl_Position = projViewMatrix * vec4(posInWorld, 1.0);
			}
		</script>

		<script id="shader-fragment" type="x-shader/x-fragment">
			precision mediump float;

			uniform vec4 ambientProduct;
			uniform vec4 diffuseProduct;
			uniform sampler2D uSampler;
			uniform int enableLighting;

			varying vec3 N, L, E;
			varying vec2 fUV;
			void main() {
				float Kd = max(dot(L, N), 0.0);

				vec4 ambient  = ambientProduct;
				vec4 diffuse  = Kd * diffuseProduct;

				vec4 fColor;

				fColor = ambient + diffuse;
				fColor.a = 1.0;

				if(enableLighting == 0) {
					fColor = (0.25 * ambient) + (0.75 * diffuseProduct);
				}

				gl_FragColor = fColor * texture2D(uSampler, fUV);
			}
		</script>

		<style>
			.columns {
				columns: 2;
				-webkit-columns: 2;
				-moz-columns: 2;
			}
		</style>
	</head>
	<body>
		<div style="width: 720px; margin: auto;">
			<center>
				<h2>Island Mystery Game</h2>
				<h3>Kyle Kodani, Kevin Lu, Ivan Petkov, Xiaosong Shi, David Vasko</h3>
			</center>

			<canvas id="gl-canvas" width="720" height="480" class="centered">
				Sorry, your browser does not support WebGL.
			</canvas>

			<br />
			<center><strong>Controls</strong></center>
			<ul class="columns">
				<li>Move around with <strong>W</strong>, <strong>A</strong>, <strong>S</strong>, <strong>D</strong></li>
				<li>Jump with <strong>SPACE</strong></li>
				<li>Look around with <strong>the mouse</strong></li>
				<li>Run by holding <strong>SHIFT</strong> while moving forward</li>
			</ul>
		</div>
	</body>
</html>
